"use strict";
function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
const jsdom_1 = require("jsdom");
exports.JSDOM = jsdom_1.JSDOM;
exports.VirtualConsole = jsdom_1.VirtualConsole;
exports.CookieJar = jsdom_1.CookieJar;
exports.toughCookie = jsdom_1.toughCookie;
const jsdom_url_1 = require("jsdom-url");
exports.URL = jsdom_url_1.URL;
exports.URLImpl = jsdom_url_1.URLImpl;
const html_1 = require("./html");
const query_1 = require("./query");
var from_url_1 = require("./from-url");
exports.fromURL = from_url_1.fromURL;
const index_1 = require("./index");
exports.Promise = index_1.Promise;
__export(require("./const"));
const const_1 = require("./const");
exports.JSDOM_PROTOTYPE_COPY = Object.assign({}, jsdom_1.JSDOM.prototype);
function auto(JSDOM) {
    packJSDOM(JSDOM.prototype);
    return JSDOM;
}
exports.auto = auto;
function createJSDOM(html, options = {}) {
    let opts = {};
    options = packOptions(options, function (options) {
        opts = options;
    });
    if (options.minifyHTML) {
        html = html_1.normalizeHTML(html).html;
        html = html_1.minifyHTML(html);
    }
    let jsdom = new jsdom_1.JSDOM(html, options);
    if (!isPackedJSDOM(jsdom)) {
        packJSDOM(jsdom);
    }
    jsdom._options.ConstructorOptions = opts;
    jsdom._options.options = options;
    return jsdom;
}
exports.createJSDOM = createJSDOM;
function asyncJSDOM(html, options = {}) {
    return index_1.Promise.resolve().then(function () {
        return createJSDOM(html, options);
    });
}
exports.asyncJSDOM = asyncJSDOM;
function fromFile(url, options) {
    return index_1.Promise.resolve().then(function () {
        let opts = {};
        options = packOptions(options, function (options) {
            opts = options;
        });
        return jsdom_1.JSDOM.fromFile(url, options)
            .then(function (jsdom) {
            if (!isPackedJSDOM(jsdom)) {
                packJSDOM(jsdom);
            }
            jsdom._options.ConstructorOptions = opts;
            jsdom._options.options = options;
            return jsdom;
        });
    });
}
exports.fromFile = fromFile;
function packOptions(options = {}, cb) {
    if (options.url !== undefined) {
        options.url = (new jsdom_url_1.URL(options.url)).href;
    }
    if (options.referrer !== undefined) {
        options.referrer = (new jsdom_url_1.URL(options.referrer)).href;
    }
    if (!options.beforeParse || !options.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS]) {
        let old_beforeParse;
        if (options.beforeParse) {
            old_beforeParse = options.beforeParse;
        }
        options.beforeParse = function (window, jsdom) {
            let opts = {};
            if (old_beforeParse) {
                old_beforeParse(window, jsdom);
            }
            opts = Object.assign({}, this);
            if (jsdom) {
                jsdom[const_1.SYMBOL_RAW] = jsdom[const_1.SYMBOL_RAW] || {};
                jsdom[const_1.SYMBOL_RAW].options = jsdom[const_1.SYMBOL_RAW].options || {};
                jsdom[const_1.SYMBOL_RAW].options.ConstructorOptions = opts;
            }
            let cbs;
            cbs = (opts.beforeParse && opts.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS])
                .concat(options.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS]);
            index_1.array_unique(cbs)
                .forEach(function (cb) {
                cb(opts, window, jsdom);
            });
        };
        options.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS] = [] || options.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS];
    }
    if (cb) {
        options.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS].push(cb);
        options.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS] = index_1.array_unique(options.beforeParse[const_1.default.SYMBOL_PACKED_OPTIONS]);
    }
    if (options.virtualConsole === false) {
        options.virtualConsole = new jsdom_1.VirtualConsole();
    }
    return options;
}
exports.packOptions = packOptions;
function isPackedJSDOM(jsdom) {
    return (const_1.default.SYMBOL_PACKED in jsdom);
}
exports.isPackedJSDOM = isPackedJSDOM;
function packJSDOM(jsdom) {
    if (isPackedJSDOM(jsdom)) {
        return jsdom;
    }
    function chk(who) {
        if (who instanceof jsdom_1.JSDOM) {
            return;
        }
        throw new Error(`object not a instance of JSDOM`);
    }
    Object.defineProperties(jsdom, {
        [const_1.default.SYMBOL_PACKED]: {
            get() {
                return true;
            }
        },
        [const_1.SYMBOL_RAW]: {
            value: Object.assign({
                options: {},
            }, jsdom[const_1.SYMBOL_RAW]),
        },
        _options: {
            get() {
                chk(this);
                return this[const_1.SYMBOL_RAW].options;
            },
            set(val = {}) {
                this[const_1.SYMBOL_RAW].options = val;
            }
        },
        document: {
            get() {
                chk(this);
                return this.window.document;
            },
        },
        url: {
            get() {
                chk(this);
                if (!this[const_1.SYMBOL_RAW].url || this[const_1.SYMBOL_RAW].window !== this.window || this[const_1.SYMBOL_RAW].window.location.href !== this.window.location.href) {
                    this[const_1.SYMBOL_RAW].window = this.window;
                    this[const_1.SYMBOL_RAW].url = new jsdom_url_1.URL(this.window.location.href);
                }
                return this[const_1.SYMBOL_RAW].url;
            }
        },
        $: {
            get() {
                chk(this);
                if (!this[const_1.SYMBOL_RAW].$ || this[const_1.SYMBOL_RAW].window !== this.window) {
                    this[const_1.SYMBOL_RAW].window = this.window;
                    this[const_1.SYMBOL_RAW].$ = query_1.createQuery(this, this[const_1.SYMBOL_RAW].options.options);
                }
                return this[const_1.SYMBOL_RAW].$;
            },
        },
        fakeThen: {
            get() {
                return function (cb) {
                    return cb(this);
                };
            }
        },
    });
    return jsdom;
}
exports.packJSDOM = packJSDOM;
exports.default = exports;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFJQSxpQ0FXZTtBQWNOLGdCQXhCUixhQUFLLENBd0JRO0FBQUUseUJBdkJmLHNCQUFjLENBdUJlO0FBQUUsb0JBdEIvQixpQkFBUyxDQXNCK0I7QUFBRSxzQkFyQjFDLG1CQUFXLENBcUIwQztBQVp0RCx5Q0FBeUM7QUFXaEMsY0FYQSxlQUFHLENBV0E7QUFBRSxrQkFYQSxtQkFBTyxDQVdBO0FBUnJCLGlDQUFtRDtBQUNuRCxtQ0FBMkQ7QUFHM0QsdUNBQXFDO0FBQTVCLDZCQUFBLE9BQU8sQ0FBQTtBQUNoQixtQ0FBZ0Q7QUFFdkMsa0JBRkEsZUFBTyxDQUVBO0FBSWhCLDZCQUF3QjtBQUN4QixtQ0FBNkM7QUFFaEMsUUFBQSxvQkFBb0IsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxhQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7QUFrRnZFLFNBQWdCLElBQUksQ0FBQyxLQUFLO0lBRXpCLFNBQVMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDM0IsT0FBTyxLQUFLLENBQUM7QUFDZCxDQUFDO0FBSkQsb0JBSUM7QUFFRCxTQUFnQixXQUFXLENBQUMsSUFBbUMsRUFBRSxVQUErQixFQUFFO0lBRWpHLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUVkLE9BQU8sR0FBRyxXQUFXLENBQUMsT0FBTyxFQUFFLFVBQVUsT0FBTztRQUUvQyxJQUFJLEdBQUcsT0FBTyxDQUFDO0lBQ2hCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxPQUFPLENBQUMsVUFBVSxFQUN0QjtRQUNDLElBQUksR0FBRyxvQkFBYSxDQUFDLElBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUMxQyxJQUFJLEdBQUcsaUJBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUN4QjtJQUVELElBQUksS0FBSyxHQUFHLElBQUksYUFBSyxD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RTtZQUNULEdBQUc7Z0JBRUYsT0FBTyxVQUFVLEVBQTJCO29CQUUzQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDakIsQ0FBQyxDQUFBO1lBQ0YsQ0FBQztTQUNEO0tBQ0QsQ0FBQyxDQUFDO0lBRUgsT0FBTyxLQUFlLENBQUM7QUFDeEIsQ0FBQztBQWxHRCw4QkFrR0M7QUFFRCxrQkFBZSxPQUFrQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxOC8yLzYvMDA2LlxuICovXG5cbmltcG9ydCB7XG5cdEpTRE9NLFxuXHRWaXJ0dWFsQ29uc29sZSxcblx0Q29va2llSmFyLFxuXHR0b3VnaENvb2tpZSxcblx0Q29uc3RydWN0b3JPcHRpb25zLFxuXHRCaW5hcnlEYXRhLFxuXHRET01XaW5kb3csXG5cdEZyb21GaWxlT3B0aW9ucyxcblx0RnJvbVVybE9wdGlvbnMsXG4vL1x0T3B0aW9ucyBhcyBJT3B0aW9uc0pTRE9NU291cmNlXG59IGZyb20gJ2pzZG9tJztcbmltcG9ydCAqIGFzIGpRdWVyeSBmcm9tICdqcXVlcnknO1xuaW1wb3J0IHsgVVJMLCBVUkxJbXBsIH0gZnJvbSAnanNkb20tdXJsJztcbmltcG9ydCB7IElPcHRpb25zV2l0aFdpbmRvd09wdGlvbnNXaXRoUmVzb3VyY2VMb2FkZXIgfSBmcm9tICcuL2Jyb3dzZXIvcmVzb3VyY2UtbG9hZGVyJztcbmltcG9ydCB7IExhenlDb29raWVKYXIgfSBmcm9tICcuL2Nvb2tpZXMnO1xuaW1wb3J0IHsgbWluaWZ5SFRNTCwgbm9ybWFsaXplSFRNTCB9IGZyb20gJy4vaHRtbCc7XG5pbXBvcnQgeyBJT3B0aW9uc0NyZWF0ZVF1ZXJ5LCBjcmVhdGVRdWVyeSB9IGZyb20gJy4vcXVlcnknO1xuaW1wb3J0IHsgSUNvb2tpZUphciwgSUZyb21VcmxPcHRpb25zLCBJUmVxdWVzdE9wdGlvbnMgfSBmcm9tICcuL2Zyb20tdXJsJztcblxuZXhwb3J0IHsgZnJvbVVSTCB9IGZyb20gJy4vZnJvbS11cmwnO1xuaW1wb3J0IHsgUHJvbWlzZSwgYXJyYXlfdW5pcXVlIH0gZnJvbSAnLi9pbmRleCc7XG5cbmV4cG9ydCB7IFByb21pc2UgfVxuZXhwb3J0IHsgVVJMLCBVUkxJbXBsIH1cbmV4cG9ydCB7IEpTRE9NLCBWaXJ0dWFsQ29uc29sZSwgQ29va2llSmFyLCB0b3VnaENvb2tpZSwgQ29uc3RydWN0b3JPcHRpb25zLCBET01XaW5kb3cgfVxuXG5leHBvcnQgKiBmcm9tICcuL2NvbnN0JztcbmltcG9ydCBDT05TVFMsIHsgU1lNQk9MX1JBVyB9IGZyb20gJy4vY29uc3QnO1xuXG5leHBvcnQgY29uc3QgSlNET01fUFJPVE9UWVBFX0NPUFkgPSBPYmplY3QuYXNzaWduKHt9LCBKU0RPTS5wcm90b3R5cGUpO1xuXG5leHBvcnQgaW50ZXJmYWNlIElPcHRpb25zXG57XG5cdGJlZm9yZVBhcnNlPyh3aW5kb3c6IERPTVdpbmRvdywganNkb20/OiBJSlNET00pOiB2b2lkO1xuXG5cdC8vcnVuU2NyaXB0cz86ICdkYW5nZXJvdXNseScgfCAnb3V0c2lkZS1vbmx5Jyxcblx0Ly9yZXNvdXJjZXM/OiAndXNhYmxlJyxcblxuXHR1cmw/OiBzdHJpbmcgfCBVUkw7XG5cdHJlZmVycmVyPzogc3RyaW5nIHwgVVJMO1xuXG5cdHZpcnR1YWxDb25zb2xlPzogVmlydHVhbENvbnNvbGUgfCBmYWxzZSxcblxuXHQvKipcblx0ICogdXNlckFnZW50IGFmZmVjdHMgdGhlIHZhbHVlIHJlYWQgZnJvbSBuYXZpZ2F0b3IudXNlckFnZW50LCBhcyB3ZWxsIGFzIHRoZSBVc2VyLUFnZW50IGhlYWRlciBzZW50IHdoaWxlIGZldGNoaW5nIHN1YnJlc291cmNlcy5cblx0ICogSXQgZGVmYXVsdHMgdG8gYE1vemlsbGEvNS4wICgke3Byb2Nlc3MucGxhdGZvcm19KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBqc2RvbS8ke2pzZG9tVmVyc2lvbn1gLlxuXHQgKi9cblx0dXNlckFnZW50Pzogc3RyaW5nO1xuXHQvKipcblx0ICogaW5jbHVkZU5vZGVMb2NhdGlvbnMgcHJlc2VydmVzIHRoZSBsb2NhdGlvbiBpbmZvIHByb2R1Y2VkIGJ5IHRoZSBIVE1MIHBhcnNlcixcblx0ICogYWxsb3dpbmcgeW91IHRvIHJldHJpZXZlIGl0IHdpdGggdGhlIG5vZGVMb2NhdGlvbigpIG1ldGhvZCAoZGVzY3JpYmVkIGJlbG93KS5cblx0ICogSXQgZGVmYXVsdHMgdG8gZmFsc2UgdG8gZ2l2ZSB0aGUgYmVzdCBwZXJmb3JtYW5jZSxcblx0ICogYW5kIGNhbm5vdCBiZSB1c2VkIHdpdGggYW4gWE1MIGNvbnRlbnQgdHlwZSBzaW5jZSBvdXIgWE1MIHBhcnNlciBkb2VzIG5vdCBzdXBwb3J0IGxvY2F0aW9uIGluZm8uXG5cdCAqL1xuXHRpbmNsdWRlTm9kZUxvY2F0aW9ucz86IGJvb2xlYW47XG5cdHJ1blNjcmlwdHM/OiAnZGFuZ2Vyb3VzbHknIHwgJ291dHNpZGUtb25seSc7XG5cdHJlc291cmNlcz86ICd1c2FibGUnO1xuXHRjb29raWVKYXI/OiBDb29raWVKYXIgfCBJQ29va2llSmFyIHwgTGF6eUNvb2tpZUphcjtcbn1cblxuZXhwb3J0IHsgSU9wdGlvbnNDcmVhdGVRdWVyeSB9XG5cbi8vZXhwb3J0IHR5cGUgSU9wdGlvbnNKU0RPTSA9IElPcHRpb25zQ3JlYXRlUXVlcnkgJiBQYXJ0aWFsPElPcHRpb25zSlNET01Tb3VyY2U+ICYgSU9wdGlvbnM7XG4vKlxuZXhwb3J0IGludGVyZmFjZSBJT3B0aW9uc0pTRE9NIGV4dGVuZHMgSU9wdGlvbnNDcmVhdGVRdWVyeSwgSU9wdGlvbnNcbntcblxufVxuKi9cblxuZXhwb3J0IHR5cGUgSU9wdGlvbnNKU0RPTSA9IElPcHRpb25zQ3JlYXRlUXVlcnkgJiBJT3B0aW9ucyAmIHtcblx0bWluaWZ5SFRNTD86IGJvb2xlYW4sXG59ICYgSU9wdGlvbnNXaXRoV2luZG93T3B0aW9uc1dpdGhSZXNvdXJjZUxvYWRlcjtcblxuZXhwb3J0IHR5cGUgSUNvbnN0cnVjdG9yT3B0aW9ucyA9IFBhcnRpYWw8Q29uc3RydWN0b3JPcHRpb25zICYgSU9wdGlvbnNKU0RPTT47XG5leHBvcnQgdHlwZSBJRnJvbUZpbGVPcHRpb25zID0gUGFydGlhbDxJT3B0aW9uc0pTRE9NICYgRnJvbUZpbGVPcHRpb25zPjtcbmV4cG9ydCB7IElGcm9tVXJsT3B0aW9ucyB9XG5leHBvcnQgdHlwZSBJQWxsT3B0aW9ucyA9IFBhcnRpYWw8SUNvbnN0cnVjdG9yT3B0aW9ucyAmIElGcm9tRmlsZU9wdGlvbnMgJiBJRnJvbVVybE9wdGlvbnM+O1xuXG5leHBvcnQgaW50ZXJmYWNlIElKU0RPTV9TeW1ib2xcbntcblx0JDogSlF1ZXJ5U3RhdGljLFxuXHR3aW5kb3c6IERPTVdpbmRvdyxcblx0dXJsOiBVUkwsXG5cblx0b3B0aW9uczogSUpTRE9NX1N5bWJvbF9PcHRpb25zLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElKU0RPTV9TeW1ib2xfT3B0aW9uc1xue1xuXHRDb25zdHJ1Y3Rvck9wdGlvbnM/OiBQYXJ0aWFsPENvbnN0cnVjdG9yT3B0aW9ucz4sXG5cdG9wdGlvbnM/OiBQYXJ0aWFsPElPcHRpb25zPixcblx0cmVxdWVzdE9wdGlvbnM/OiBQYXJ0aWFsPElSZXF1ZXN0T3B0aW9ucz4sXG5cblx0UmVzcG9uc2U/LFxuXHRib2R5Pyxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJSlNET01fRVhURU5EIGV4dGVuZHMgSlNET01cbntcblx0JDogSlF1ZXJ5U3RhdGljLFxuXHR1cmw6IFVSTCxcblx0ZG9jdW1lbnQ6IERvY3VtZW50LFxuXG5cdF9vcHRpb25zOiBJSlNET01fU3ltYm9sX09wdGlvbnMsXG5cblx0ZmFrZVRoZW48VD4oY2I6IChqc2RvbTogSUpTRE9NKSA9PiBUKTogVFxufVxuXG5leHBvcnQgdHlwZSBJSlNET00gPSBKU0RPTSAmIElKU0RPTV9FWFRFTkQ7XG5cbmV4cG9ydCBmdW5jdGlvbiBhdXRvKEpTRE9NKVxue1xuXHRwYWNrSlNET00oSlNET00ucHJvdG90eXBlKTtcblx0cmV0dXJuIEpTRE9NO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSlNET00oaHRtbD86IHN0cmluZyB8IEJ1ZmZlciB8IEJpbmFyeURhdGEsIG9wdGlvbnM6IElDb25zdHJ1Y3Rvck9wdGlvbnMgPSB7fSk6IElKU0RPTVxue1xuXHRsZXQgb3B0cyA9IHt9O1xuXG5cdG9wdGlvbnMgPSBwYWNrT3B0aW9ucyhvcHRpb25zLCBmdW5jdGlvbiAob3B0aW9ucylcblx0e1xuXHRcdG9wdHMgPSBvcHRpb25zO1xuXHR9KTtcblxuXHRpZiAob3B0aW9ucy5taW5pZnlIVE1MKVxuXHR7XG5cdFx0aHRtbCA9IG5vcm1hbGl6ZUhUTUwoaHRtbCBhcyBzdHJpbmcpLmh0bWw7XG5cdFx0aHRtbCA9IG1pbmlmeUhUTUwoaHRtbCk7XG5cdH1cblxuXHRsZXQganNkb20gPSBuZXcgSlNET00oaHRtbCwgb3B0aW9ucykgYXMgSUpTRE9NO1xuXG5cdGlmICghaXNQYWNrZWRKU0RPTShqc2RvbSkpXG5cdHtcblx0XHRwYWNrSlNET00oanNkb20pO1xuXHR9XG5cblx0anNkb20uX29wdGlvbnMuQ29uc3RydWN0b3JPcHRpb25zID0gb3B0cztcblx0anNkb20uX29wdGlvbnMub3B0aW9ucyA9IG9wdGlvbnM7XG5cblx0cmV0dXJuIGpzZG9tO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXN5bmNKU0RPTShodG1sPzogc3RyaW5nIHwgQnVmZmVyIHwgQmluYXJ5RGF0YSwgb3B0aW9uczogSUNvbnN0cnVjdG9yT3B0aW9ucyA9IHt9KTogUHJvbWlzZTxJSlNET00+XG57XG5cdHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uICgpXG5cdHtcblx0XHRyZXR1cm4gY3JlYXRlSlNET00oaHRtbCwgb3B0aW9ucyk7XG5cdH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZnJvbUZpbGUodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBJRnJvbUZpbGVPcHRpb25zKTogUHJvbWlzZTxJSlNET00+XG57XG5cdHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uICgpXG5cdHtcblx0XHRsZXQgb3B0cyA9IHt9O1xuXG5cdFx0b3B0aW9ucyA9IHBhY2tPcHRpb25zKG9wdGlvbnMsIGZ1bmN0aW9uIChvcHRpb25zKVxuXHRcdHtcblx0XHRcdG9wdHMgPSBvcHRpb25zO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIEpTRE9NLmZyb21GaWxlKHVybCwgb3B0aW9ucylcblx0XHRcdC50aGVuKGZ1bmN0aW9uIChqc2RvbTogSUpTRE9NKVxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoIWlzUGFja2VkSlNET00oanNkb20pKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cGFja0pTRE9NKGpzZG9tKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGpzZG9tLl9vcHRpb25zLkNvbnN0cnVjdG9yT3B0aW9ucyA9IG9wdHM7XG5cdFx0XHRcdGpzZG9tLl9vcHRpb25zLm9wdGlvbnMgPSBvcHRpb25zO1xuXG5cdFx0XHRcdHJldHVybiBqc2RvbTtcblx0XHRcdH0pXG5cdFx0XHQ7XG5cdH0pO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElQYWNrT3B0aW9uc0hvb2tDYWxsYmFjazxUPlxue1xuXHQob3B0czogUGFydGlhbDxUICYgSU9wdGlvbnNKU0RPTT4sIHdpbmRvdz86IERPTVdpbmRvdywganNkb20/OiBKU0RPTSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhY2tPcHRpb25zPFQ+KG9wdGlvbnM6IFBhcnRpYWw8VCAmIElPcHRpb25zSlNET00+ID0ge30sXG5cdGNiPzogSVBhY2tPcHRpb25zSG9va0NhbGxiYWNrPFQ+XG4pOiBQYXJ0aWFsPFQgJiBJT3B0aW9uc0pTRE9NPlxue1xuXHRpZiAob3B0aW9ucy51cmwgIT09IHVuZGVmaW5lZClcblx0e1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRvcHRpb25zLnVybCA9IChuZXcgVVJMKG9wdGlvbnMudXJsKSkuaHJlZjtcblx0fVxuXG5cdGlmIChvcHRpb25zLnJlZmVycmVyICE9PSB1bmRlZmluZWQpXG5cdHtcblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0b3B0aW9ucy5yZWZlcnJlciA9IChuZXcgVVJMKG9wdGlvbnMucmVmZXJyZXIpKS5ocmVmO1xuXHR9XG5cblx0aWYgKCFvcHRpb25zLmJlZm9yZVBhcnNlIHx8ICFvcHRpb25zLmJlZm9yZVBhcnNlW0NPTlNUUy5TWU1CT0xfUEFDS0VEX09QVElPTlNdKVxuXHR7XG5cdFx0bGV0IG9sZF9iZWZvcmVQYXJzZTtcblxuXHRcdGlmIChvcHRpb25zLmJlZm9yZVBhcnNlKVxuXHRcdHtcblx0XHRcdG9sZF9iZWZvcmVQYXJzZSA9IG9wdGlvbnMuYmVmb3JlUGFyc2U7XG5cdFx0fVxuXG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdG9wdGlvbnMuYmVmb3JlUGFyc2UgPSBmdW5jdGlvbiAod2luZG93OiBET01XaW5kb3csIGpzZG9tPzogSUpTRE9NKVxuXHRcdHtcblx0XHRcdGxldCBvcHRzOiBQYXJ0aWFsPFQgJiBJT3B0aW9uc0pTRE9NPiA9IHt9O1xuXG5cdFx0XHRpZiAob2xkX2JlZm9yZVBhcnNlKVxuXHRcdFx0e1xuXHRcdFx0XHRvbGRfYmVmb3JlUGFyc2Uod2luZG93LCBqc2RvbSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vY29uc29sZS5sb2codGhpcyk7XG5cdFx0XHRvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcyk7XG5cblx0XHRcdGlmIChqc2RvbSlcblx0XHRcdHtcblx0XHRcdFx0anNkb21bU1lNQk9MX1JBV10gPSBqc2RvbVtTWU1CT0xfUkFXXSB8fCB7fTtcblx0XHRcdFx0anNkb21bU1lNQk9MX1JBV10ub3B0aW9ucyA9IGpzZG9tW1NZTUJPTF9SQVddLm9wdGlvbnMgfHwge307XG5cdFx0XHRcdGpzZG9tW1NZTUJPTF9SQVddLm9wdGlvbnMuQ29uc3RydWN0b3JPcHRpb25zID0gb3B0cztcblx0XHRcdH1cblxuXHRcdFx0bGV0IGNiczogSVBhY2tPcHRpb25zSG9va0NhbGxiYWNrPFQ+W107XG5cblx0XHRcdGNicyA9IChvcHRzLmJlZm9yZVBhcnNlICYmIG9wdHMuYmVmb3JlUGFyc2VbQ09OU1RTLlNZTUJPTF9QQUNLRURfT1BUSU9OU10pXG5cdFx0XHRcdC5jb25jYXQob3B0aW9ucy5iZWZvcmVQYXJzZVtDT05TVFMuU1lNQk9MX1BBQ0tFRF9PUFRJT05TXSlcblx0XHRcdDtcblxuXHRcdFx0Ly9jYiAmJiBjYihvcHRzLCB3aW5kb3csIGpzZG9tKTtcblx0XHRcdGFycmF5X3VuaXF1ZShjYnMpXG5cdFx0XHRcdC5mb3JFYWNoKGZ1bmN0aW9uIChjYjogSVBhY2tPcHRpb25zSG9va0NhbGxiYWNrPFQ+KVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Y2Iob3B0cywgd2luZG93LCBqc2RvbSk7XG5cdFx0XHRcdH0pXG5cdFx0XHQ7XG5cdFx0fTtcblx0XHRvcHRpb25zLmJlZm9yZVBhcnNlW0NPTlNUUy5TWU1CT0xfUEFDS0VEX09QVElPTlNdID0gW10gfHwgb3B0aW9ucy5iZWZvcmVQYXJzZVtDT05TVFMuU1lNQk9MX1BBQ0tFRF9PUFRJT05TXTtcblx0fVxuXHRpZiAoY2IpXG5cdHtcblx0XHRvcHRpb25zLmJlZm9yZVBhcnNlW0NPTlNUUy5TWU1CT0xfUEFDS0VEX09QVElPTlNdLnB1c2goY2IpO1xuXG5cdFx0b3B0aW9ucy5iZWZvcmVQYXJzZVtDT05TVFMuU1lNQk9MX1BBQ0tFRF9PUFRJT05TXSA9IGFycmF5X3VuaXF1ZShvcHRpb25zLmJlZm9yZVBhcnNlW0NPTlNUUy5TWU1CT0xfUEFDS0VEX09QVElPTlNdKTtcblx0fVxuXG5cdGlmIChvcHRpb25zLnZpcnR1YWxDb25zb2xlID09PSBmYWxzZSlcblx0e1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRvcHRpb25zLnZpcnR1YWxDb25zb2xlID0gbmV3IFZpcnR1YWxDb25zb2xlKCk7XG5cdH1cblxuXHRyZXR1cm4gb3B0aW9ucztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUGFja2VkSlNET00oanNkb20pXG57XG5cdC8vcmV0dXJuIChTWU1CT0xfUkFXIGluIGpzZG9tKTtcblx0cmV0dXJuIChDT05TVFMuU1lNQk9MX1BBQ0tFRCBpbiBqc2RvbSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYWNrSlNET00oanNkb206IEpTRE9NKTogSUpTRE9NXG57XG5cdGlmIChpc1BhY2tlZEpTRE9NKGpzZG9tKSlcblx0e1xuXHRcdHJldHVybiBqc2RvbSBhcyBJSlNET007XG5cdH1cblxuXHRmdW5jdGlvbiBjaGsod2hvKVxuXHR7XG5cdFx0aWYgKHdobyBpbnN0YW5jZW9mIEpTRE9NKVxuXHRcdHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aHJvdyBuZXcgRXJyb3IoYG9iamVjdCBub3QgYSBpbnN0YW5jZSBvZiBKU0RPTWApO1xuXHR9XG5cblx0T2JqZWN0LmRlZmluZVByb3BlcnRpZXMoanNkb20sIHtcblxuXHRcdFtDT05TVFMuU1lNQk9MX1BBQ0tFRF06IHtcblx0XHRcdGdldCgpXG5cdFx0XHR7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRbU1lNQk9MX1JBV106IHtcblx0XHRcdHZhbHVlOiBPYmplY3QuYXNzaWduKHtcblx0XHRcdFx0b3B0aW9uczoge30sXG5cdFx0XHR9LCBqc2RvbVtTWU1CT0xfUkFXXSkgYXMgSUpTRE9NX1N5bWJvbCxcblx0XHR9LFxuXG5cdFx0X29wdGlvbnM6IHtcblx0XHRcdGdldCgpXG5cdFx0XHR7XG5cdFx0XHRcdGNoayh0aGlzKTtcblxuXHRcdFx0XHRyZXR1cm4gdGhpc1tTWU1CT0xfUkFXXS5vcHRpb25zO1xuXHRcdFx0fSxcblx0XHRcdHNldCh2YWwgPSB7fSlcblx0XHRcdHtcblx0XHRcdFx0dGhpc1tTWU1CT0xfUkFXXS5vcHRpb25zID0gdmFsO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRkb2N1bWVudDoge1xuXHRcdFx0Z2V0KClcblx0XHRcdHtcblx0XHRcdFx0Y2hrKHRoaXMpO1xuXG5cdFx0XHRcdHJldHVybiB0aGlzLndpbmRvdy5kb2N1bWVudDtcblx0XHRcdH0sXG5cdFx0fSxcblxuXHRcdHVybDoge1xuXHRcdFx0Z2V0KClcblx0XHRcdHtcblx0XHRcdFx0Y2hrKHRoaXMpO1xuXG5cdFx0XHRcdGlmICghdGhpc1tTWU1CT0xfUkFXXS51cmwgfHwgdGhpc1tTWU1CT0xfUkFXXS53aW5kb3cgIT09IHRoaXMud2luZG93IHx8IHRoaXNbU1lNQk9MX1JBV10ud2luZG93LmxvY2F0aW9uLmhyZWYgIT09IHRoaXMud2luZG93LmxvY2F0aW9uLmhyZWYpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0aGlzW1NZTUJPTF9SQVddLndpbmRvdyA9IHRoaXMud2luZG93O1xuXHRcdFx0XHRcdHRoaXNbU1lNQk9MX1JBV10udXJsID0gbmV3IFVSTCh0aGlzLndpbmRvdy5sb2NhdGlvbi5ocmVmKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0aGlzW1NZTUJPTF9SQVddLnVybDtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0JDoge1xuXHRcdFx0Z2V0KClcblx0XHRcdHtcblx0XHRcdFx0Y2hrKHRoaXMpO1xuXG5cdFx0XHRcdGlmICghdGhpc1tTWU1CT0xfUkFXXS4kIHx8IHRoaXNbU1lNQk9MX1JBV10ud2luZG93ICE9PSB0aGlzLndpbmRvdylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHRoaXNbU1lNQk9MX1JBV10ud2luZG93ID0gdGhpcy53aW5kb3c7XG5cdFx0XHRcdFx0Ly8gQHRzLWlnbm9yZVxuXG5cdFx0XHRcdFx0dGhpc1tTWU1CT0xfUkFXXS4kID0gY3JlYXRlUXVlcnkodGhpcywgdGhpc1tTWU1CT0xfUkFXXS5vcHRpb25zLm9wdGlvbnMpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHRoaXNbU1lNQk9MX1JBV10uJDtcblx0XHRcdH0sXG5cdFx0fSxcblxuXHRcdGZha2VUaGVuOiB7XG5cdFx0XHRnZXQoKVxuXHRcdFx0e1xuXHRcdFx0XHRyZXR1cm4gZnVuY3Rpb24gKGNiOiA8VD4oanNkb206IElKU0RPTSkgPT4gVClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJldHVybiBjYih0aGlzKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cdH0pO1xuXG5cdHJldHVybiBqc2RvbSBhcyBJSlNET007XG59XG5cbmV4cG9ydCBkZWZhdWx0IGV4cG9ydHMgYXMgdHlwZW9mIGltcG9ydCgnLi9wYWNrJyk7XG4iXX0=